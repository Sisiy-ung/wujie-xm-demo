{"version":3,"file":"effect.js","names":["getExternalStyleSheets","getExternalScripts","getWujieById","rawAppendChild","rawElementContains","rawElementRemoveChild","rawHeadInsertBefore","rawBodyInsertBefore","rawInsertAdjacentElement","rawDocumentQuerySelector","rawAddEventListener","rawRemoveEventListener","isFunction","isHijackingTag","warn","nextTick","getCurUrl","execHooks","isScriptElement","setTagToScript","getTagFromScript","setAttrsToElement","insertScriptToIframe","patchElementEffect","getPatchStyleElements","getCssLoader","getEffectLoaders","isMatchUrl","WUJIE_SCRIPT_ID","WUJIE_DATA_FLAG","WUJIE_TIPS_REPEAT_RENDER","WUJIE_TIPS_NO_SCRIPT","parseTagAttributes","patchCustomEvent","e","elementGetter","Object","defineProperties","srcElement","get","target","manualInvokeElementEvent","element","event","customEvent","CustomEvent","patchedEvent","concat","dispatchEvent","handleStylesheetElementPatch","stylesheetElement","sandbox","innerHTML","degrade","patcher","_getPatchStyleElement","sheet","_getPatchStyleElement2","_slicedToArray","hostStyleSheetElement","fontStyleSheetElement","shadowRoot","head","appendChild","host","_patcher","undefined","clearTimeout","setTimeout","patchStylesheetElement","cssLoader","curUrl","_stylesheetElement$sh","_hasPatchStyle","innerHTMLDesc","getOwnPropertyDescriptor","Element","prototype","innerTextDesc","HTMLElement","textContentDesc","Node","RawInsertRule","insertRule","patchSheetInsertRule","rule","index","innerText","call","set","code","_this","_this2","textContent","_this3","value","node","_this4","nodeType","TEXT_NODE","res","ownerDocument","createTextNode","insertAdjacentElement","position","nodeName","styleSheetElements","push","dynamicScriptExecStack","Promise","resolve","rewriteAppendOrInsertChild","opts","appendChildOrInsertBefore","newChild","refChild","_this5","rawDOMAppendOrInsertBefore","wujieId","replace","fetch","plugins","iframe","lifecycles","proxyLocation","fiber","tagName","contentWindow","iframeDocument","contentDocument","_element$tagName","toUpperCase","_ref","href","rel","type","styleFlag","endsWith","src","ignore","loadError","forEach","_ref2","contentPromise","then","content","rawAttrs","outerHTML","createElement","comment","createComment","_ref3","text","crossOrigin","execScript","scriptResult","onload","_objectSpread","scriptOptions","module","crossorigin","crossoriginType","attrs","_sandbox$execQueue","execQueue","execQueueLength","length","requestIdleCallback","shift","_sandbox$execQueue2","getAttribute","findScriptElementFromIframe","rawElement","wujieTag","targetScript","__WUJIE_RAW_DOCUMENT_HEAD__","querySelector","rewriteContains","contains","other","_findScriptElementFro","rewriteRemoveChild","removeChild","child","_findScriptElementFro2","patchEventListener","listenerMap","Map","_cacheListeners","addEventListener","listener","options","listeners","_toConsumableArray","removeEventListener","typeListeners","indexOf","splice","entries","_ref4","_ref5","patchRenderEffect","render","id","body","insertBefore","bind"],"sources":["../src/effect.ts"],"sourcesContent":["import { getExternalStyleSheets, getExternalScripts } from \"./entry\";\nimport {\n  getWujieById,\n  rawAppendChild,\n  rawElementContains,\n  rawElementRemoveChild,\n  rawHeadInsertBefore,\n  rawBodyInsertBefore,\n  rawInsertAdjacentElement,\n  rawDocumentQuerySelector,\n  rawAddEventListener,\n  rawRemoveEventListener,\n} from \"./common\";\nimport {\n  isFunction,\n  isHijackingTag,\n  warn,\n  nextTick,\n  getCurUrl,\n  execHooks,\n  isScriptElement,\n  setTagToScript,\n  getTagFromScript,\n  setAttrsToElement,\n} from \"./utils\";\nimport { insertScriptToIframe, patchElementEffect } from \"./iframe\";\nimport Wujie from \"./sandbox\";\nimport { getPatchStyleElements } from \"./shadow\";\nimport { getCssLoader, getEffectLoaders, isMatchUrl } from \"./plugin\";\nimport { WUJIE_SCRIPT_ID, WUJIE_DATA_FLAG, WUJIE_TIPS_REPEAT_RENDER, WUJIE_TIPS_NO_SCRIPT } from \"./constant\";\nimport { ScriptObject, parseTagAttributes } from \"./template\";\n\nfunction patchCustomEvent(\n  e: CustomEvent,\n  elementGetter: () => HTMLScriptElement | HTMLLinkElement | null\n): CustomEvent {\n  Object.defineProperties(e, {\n    srcElement: {\n      get: elementGetter,\n    },\n    target: {\n      get: elementGetter,\n    },\n  });\n\n  return e;\n}\n\n/**\n * 手动触发事件回调\n */\nfunction manualInvokeElementEvent(element: HTMLLinkElement | HTMLScriptElement, event: string): void {\n  const customEvent = new CustomEvent(event);\n  const patchedEvent = patchCustomEvent(customEvent, () => element);\n  if (isFunction(element[`on${event}`])) {\n    element[`on${event}`](patchedEvent);\n  } else {\n    element.dispatchEvent(patchedEvent);\n  }\n}\n\n/**\n * 样式元素的css变量处理，每个stylesheetElement单独节流\n */\nfunction handleStylesheetElementPatch(stylesheetElement: HTMLStyleElement & { _patcher?: any }, sandbox: Wujie) {\n  if (!stylesheetElement.innerHTML || sandbox.degrade) return;\n  const patcher = () => {\n    const [hostStyleSheetElement, fontStyleSheetElement] = getPatchStyleElements([stylesheetElement.sheet]);\n    if (hostStyleSheetElement) {\n      sandbox.shadowRoot.head.appendChild(hostStyleSheetElement);\n    }\n    if (fontStyleSheetElement) {\n      sandbox.shadowRoot.host.appendChild(fontStyleSheetElement);\n    }\n    stylesheetElement._patcher = undefined;\n  };\n  if (stylesheetElement._patcher) {\n    clearTimeout(stylesheetElement._patcher);\n  }\n  stylesheetElement._patcher = setTimeout(patcher, 50);\n}\n\n/**\n * 劫持处理样式元素的属性\n */\nfunction patchStylesheetElement(\n  stylesheetElement: HTMLStyleElement & { _hasPatchStyle?: boolean },\n  cssLoader: (code: string, url: string, base: string) => string,\n  sandbox: Wujie,\n  curUrl: string\n) {\n  if (stylesheetElement._hasPatchStyle) return;\n  const innerHTMLDesc = Object.getOwnPropertyDescriptor(Element.prototype, \"innerHTML\");\n  const innerTextDesc = Object.getOwnPropertyDescriptor(HTMLElement.prototype, \"innerText\");\n  const textContentDesc = Object.getOwnPropertyDescriptor(Node.prototype, \"textContent\");\n  const RawInsertRule = stylesheetElement.sheet?.insertRule;\n  // 这个地方将cssRule加到innerHTML中去，防止子应用切换之后丢失\n  function patchSheetInsertRule() {\n    if (!RawInsertRule) return;\n    stylesheetElement.sheet.insertRule = (rule: string, index?: number): number => {\n      innerHTMLDesc ? (stylesheetElement.innerHTML += rule) : (stylesheetElement.innerText += rule);\n      return RawInsertRule.call(stylesheetElement.sheet, rule, index);\n    };\n  }\n  patchSheetInsertRule();\n\n  if (innerHTMLDesc) {\n    Object.defineProperties(stylesheetElement, {\n      innerHTML: {\n        get: function () {\n          return innerHTMLDesc.get.call(stylesheetElement);\n        },\n        set: function (code: string) {\n          innerHTMLDesc.set.call(stylesheetElement, cssLoader(code, \"\", curUrl));\n          nextTick(() => handleStylesheetElementPatch(this, sandbox));\n        },\n      },\n    });\n  }\n\n  Object.defineProperties(stylesheetElement, {\n    innerText: {\n      get: function () {\n        return innerTextDesc.get.call(stylesheetElement);\n      },\n      set: function (code: string) {\n        innerTextDesc.set.call(stylesheetElement, cssLoader(code, \"\", curUrl));\n        nextTick(() => handleStylesheetElementPatch(this, sandbox));\n      },\n    },\n    textContent: {\n      get: function () {\n        return textContentDesc.get.call(stylesheetElement);\n      },\n      set: function (code: string) {\n        textContentDesc.set.call(stylesheetElement, cssLoader(code, \"\", curUrl));\n        nextTick(() => handleStylesheetElementPatch(this, sandbox));\n      },\n    },\n    appendChild: {\n      value: function (node: Node): Node {\n        nextTick(() => handleStylesheetElementPatch(this, sandbox));\n        if (node.nodeType === Node.TEXT_NODE) {\n          const res = rawAppendChild.call(\n            stylesheetElement,\n            stylesheetElement.ownerDocument.createTextNode(cssLoader(node.textContent, \"\", curUrl))\n          );\n          // 当appendChild之后，样式元素的sheet对象发生改变，要重新patch\n          patchSheetInsertRule();\n          return res;\n        } else return rawAppendChild(node);\n      },\n    },\n    insertAdjacentElement: {\n      value: function (this: HTMLStyleElement, position: InsertPosition, element: Element) {\n        if (element.nodeName === \"STYLE\") {\n          nextTick(() => handleStylesheetElementPatch(element as HTMLStyleElement, sandbox));\n          const res = rawInsertAdjacentElement.call(this, position, element);\n          sandbox.styleSheetElements.push(element as HTMLStyleElement);\n          return res;\n        } else return rawInsertAdjacentElement.call(this, position, element);\n      },\n    },\n    _hasPatchStyle: { get: () => true },\n  });\n}\n\nlet dynamicScriptExecStack = Promise.resolve();\nfunction rewriteAppendOrInsertChild(opts: {\n  rawDOMAppendOrInsertBefore: <T extends Node>(newChild: T, refChild?: Node | null) => T;\n  wujieId: string;\n}) {\n  return function appendChildOrInsertBefore<T extends Node>(\n    this: HTMLHeadElement | HTMLBodyElement,\n    newChild: T,\n    refChild?: Node | null\n  ) {\n    let element = newChild as any;\n    const { rawDOMAppendOrInsertBefore, wujieId } = opts;\n    const sandbox = getWujieById(wujieId);\n\n    const { styleSheetElements, replace, fetch, plugins, iframe, lifecycles, proxyLocation, fiber } = sandbox;\n\n    if (!isHijackingTag(element.tagName) || !wujieId) {\n      const res = rawDOMAppendOrInsertBefore.call(this, element, refChild) as T;\n      patchElementEffect(element, iframe.contentWindow);\n      execHooks(plugins, \"appendOrInsertElementHook\", element, iframe.contentWindow);\n      return res;\n    }\n\n    const iframeDocument = iframe.contentDocument;\n    const curUrl = getCurUrl(proxyLocation);\n\n    // TODO 过滤可以开放\n    if (element.tagName) {\n      switch (element.tagName?.toUpperCase()) {\n        case \"LINK\": {\n          const { href, rel, type } = element as HTMLLinkElement;\n          const styleFlag = rel === \"stylesheet\" || type === \"text/css\" || href.endsWith(\".css\");\n          // 非 stylesheet 不做处理\n          if (!styleFlag) {\n            const res = rawDOMAppendOrInsertBefore.call(this, element, refChild);\n            execHooks(plugins, \"appendOrInsertElementHook\", element, iframe.contentWindow);\n            return res;\n          }\n          // 排除css\n          if (href && !isMatchUrl(href, getEffectLoaders(\"cssExcludes\", plugins))) {\n            getExternalStyleSheets(\n              [{ src: href, ignore: isMatchUrl(href, getEffectLoaders(\"cssIgnores\", plugins)) }],\n              fetch,\n              lifecycles.loadError\n            ).forEach(({ src, ignore, contentPromise }) =>\n              contentPromise.then(\n                (content) => {\n                  // 处理 ignore 样式\n                  const rawAttrs = parseTagAttributes(element.outerHTML);\n                  if (ignore && src) {\n                    // const stylesheetElement = iframeDocument.createElement(\"link\");\n                    // const attrs = {\n                    //   ...rawAttrs,\n                    //   type: \"text/css\",\n                    //   rel: \"stylesheet\",\n                    //   href: src,\n                    // };\n                    // setAttrsToElement(stylesheetElement, attrs);\n                    // rawDOMAppendOrInsertBefore.call(this, stylesheetElement, refChild);\n                    // manualInvokeElementEvent(element, \"load\");\n                    // 忽略的元素应该直接把对应元素插入，而不是用新的 link 标签进行替代插入，保证 element 的上下文正常\n                    rawDOMAppendOrInsertBefore.call(this, element, refChild);\n                  } else {\n                    // 记录js插入样式，子应用重新激活时恢复\n                    const stylesheetElement = iframeDocument.createElement(\"style\");\n                    // 处理css-loader插件\n                    const cssLoader = getCssLoader({ plugins, replace });\n                    stylesheetElement.innerHTML = cssLoader(content, src, curUrl);\n                    styleSheetElements.push(stylesheetElement);\n                    setAttrsToElement(stylesheetElement, rawAttrs);\n                    rawDOMAppendOrInsertBefore.call(this, stylesheetElement, refChild);\n                    // 处理样式补丁\n                    handleStylesheetElementPatch(stylesheetElement, sandbox);\n                    manualInvokeElementEvent(element, \"load\");\n                  }\n                  element = null;\n                },\n                () => {\n                  manualInvokeElementEvent(element, \"error\");\n                  element = null;\n                }\n              )\n            );\n          }\n\n          const comment = iframeDocument.createComment(`dynamic link ${href} replaced by wujie`);\n          return rawDOMAppendOrInsertBefore.call(this, comment, refChild);\n        }\n        case \"STYLE\": {\n          const stylesheetElement: HTMLStyleElement = newChild as any;\n          styleSheetElements.push(stylesheetElement);\n          const content = stylesheetElement.innerHTML;\n          const cssLoader = getCssLoader({ plugins, replace });\n          content && (stylesheetElement.innerHTML = cssLoader(content, \"\", curUrl));\n          const res = rawDOMAppendOrInsertBefore.call(this, element, refChild);\n          // 处理样式补丁\n          patchStylesheetElement(stylesheetElement, cssLoader, sandbox, curUrl);\n          handleStylesheetElementPatch(stylesheetElement, sandbox);\n          execHooks(plugins, \"appendOrInsertElementHook\", element, iframe.contentWindow);\n          return res;\n        }\n        case \"SCRIPT\": {\n          setTagToScript(element);\n          const { src, text, type, crossOrigin } = element as HTMLScriptElement;\n          // 排除js\n          if (src && !isMatchUrl(src, getEffectLoaders(\"jsExcludes\", plugins))) {\n            const execScript = (scriptResult: ScriptObject) => {\n              // 假如子应用被连续渲染两次，两次渲染会导致处理流程的交叉污染\n              if (sandbox.iframe === null) return warn(WUJIE_TIPS_REPEAT_RENDER);\n              const onload = () => {\n                manualInvokeElementEvent(element, \"load\");\n                element = null;\n              };\n              insertScriptToIframe({ ...scriptResult, onload }, sandbox.iframe.contentWindow, element);\n            };\n            const scriptOptions = {\n              src,\n              module: type === \"module\",\n              crossorigin: crossOrigin !== null,\n              crossoriginType: crossOrigin || \"\",\n              ignore: isMatchUrl(src, getEffectLoaders(\"jsIgnores\", plugins)),\n              attrs: parseTagAttributes(element.outerHTML),\n            } as ScriptObject;\n            getExternalScripts([scriptOptions], fetch, lifecycles.loadError, fiber).forEach((scriptResult) => {\n              dynamicScriptExecStack = dynamicScriptExecStack.then(() =>\n                scriptResult.contentPromise.then(\n                  (content) => {\n                    if (sandbox.execQueue === null) return warn(WUJIE_TIPS_REPEAT_RENDER);\n                    const execQueueLength = sandbox.execQueue?.length;\n                    sandbox.execQueue.push(() =>\n                      fiber\n                        ? sandbox.requestIdleCallback(() => {\n                            execScript({ ...scriptResult, content });\n                          })\n                        : execScript({ ...scriptResult, content })\n                    );\n                    // 同步脚本如果都执行完了，需要手动触发执行\n                    if (!execQueueLength) sandbox.execQueue.shift()();\n                  },\n                  () => {\n                    manualInvokeElementEvent(element, \"error\");\n                    element = null;\n                  }\n                )\n              );\n            });\n          } else {\n            const execQueueLength = sandbox.execQueue?.length;\n            sandbox.execQueue.push(() =>\n              fiber\n                ? sandbox.requestIdleCallback(() => {\n                    insertScriptToIframe(\n                      { src: null, content: text, attrs: parseTagAttributes(element.outerHTML) },\n                      sandbox.iframe.contentWindow,\n                      element\n                    );\n                  })\n                : insertScriptToIframe(\n                    { src: null, content: text, attrs: parseTagAttributes(element.outerHTML) },\n                    sandbox.iframe.contentWindow,\n                    element\n                  )\n            );\n            if (!execQueueLength) sandbox.execQueue.shift()();\n          }\n          // inline script never trigger the onload and onerror event\n          const comment = iframeDocument.createComment(`dynamic script ${src} replaced by wujie`);\n          return rawDOMAppendOrInsertBefore.call(this, comment, refChild);\n        }\n        // 修正子应用内部iframe的window.parent指向\n        case \"IFRAME\": {\n          // 嵌套的子应用的js-iframe需要插入子应用的js-iframe内部\n          if (element.getAttribute(WUJIE_DATA_FLAG) === \"\") {\n            return rawAppendChild.call(rawDocumentQuerySelector.call(this.ownerDocument, \"html\"), element);\n          }\n          const res = rawDOMAppendOrInsertBefore.call(this, element, refChild);\n          execHooks(plugins, \"appendOrInsertElementHook\", element, iframe.contentWindow);\n          return res;\n        }\n        default:\n      }\n    }\n  };\n}\n\nfunction findScriptElementFromIframe(rawElement: HTMLScriptElement, wujieId: string) {\n  const wujieTag = getTagFromScript(rawElement);\n  const sandbox = getWujieById(wujieId);\n  const { iframe } = sandbox;\n  const targetScript = iframe.contentWindow.__WUJIE_RAW_DOCUMENT_HEAD__.querySelector(\n    `script[${WUJIE_SCRIPT_ID}='${wujieTag}']`\n  );\n  if (targetScript === null) {\n    warn(WUJIE_TIPS_NO_SCRIPT, `<script ${WUJIE_SCRIPT_ID}='${wujieTag}'/>`);\n  }\n  return { targetScript, iframe };\n}\n\nfunction rewriteContains(opts: { rawElementContains: (other: Node | null) => boolean; wujieId: string }) {\n  return function contains(other: Node | null) {\n    const element = other as HTMLElement;\n    const { rawElementContains, wujieId } = opts;\n    if (element && isScriptElement(element)) {\n      const { targetScript } = findScriptElementFromIframe(element as HTMLScriptElement, wujieId);\n      return targetScript !== null;\n    }\n    return rawElementContains(element);\n  };\n}\n\nfunction rewriteRemoveChild(opts: { rawElementRemoveChild: <T extends Node>(child: T) => T; wujieId: string }) {\n  return function removeChild(child: Node) {\n    const element = child as HTMLElement;\n    const { rawElementRemoveChild, wujieId } = opts;\n    if (element && isScriptElement(element)) {\n      const { targetScript, iframe } = findScriptElementFromIframe(element as HTMLScriptElement, wujieId);\n      if (targetScript !== null) {\n        return iframe.contentWindow.__WUJIE_RAW_DOCUMENT_HEAD__.removeChild(targetScript);\n      }\n      return null;\n    }\n    return rawElementRemoveChild(element);\n  };\n}\n\n/**\n * 记录head和body的事件，等重新渲染复用head和body时需要清空事件\n */\nfunction patchEventListener(element: HTMLHeadElement | HTMLBodyElement) {\n  const listenerMap = new Map<string, EventListenerOrEventListenerObject[]>();\n  element._cacheListeners = listenerMap;\n\n  element.addEventListener = (\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions\n  ) => {\n    const listeners = listenerMap.get(type) || [];\n    listenerMap.set(type, [...listeners, listener]);\n    return rawAddEventListener.call(element, type, listener, options);\n  };\n\n  element.removeEventListener = (\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions\n  ) => {\n    const typeListeners = listenerMap.get(type);\n    const index = typeListeners?.indexOf(listener);\n    if (typeListeners?.length && index !== -1) {\n      typeListeners.splice(index, 1);\n    }\n    return rawRemoveEventListener.call(element, type, listener, options);\n  };\n}\n\n/**\n * 清空head和body的绑定的事件\n */\nexport function removeEventListener(element: HTMLHeadElement | HTMLBodyElement) {\n  const listenerMap = element._cacheListeners;\n  [...listenerMap.entries()].forEach(([type, listeners]) => {\n    listeners.forEach((listener) => rawRemoveEventListener.call(element, type, listener));\n  });\n}\n\n/**\n * patch head and body in render\n * intercept appendChild and insertBefore\n */\nexport function patchRenderEffect(render: ShadowRoot | Document, id: string, degrade: boolean): void {\n  // 降级场景dom渲染在iframe中，iframe移动后事件自动销毁，不需要记录\n  if (!degrade) {\n    patchEventListener(render.head);\n    patchEventListener(render.body as HTMLBodyElement);\n  }\n\n  render.head.appendChild = rewriteAppendOrInsertChild({\n    rawDOMAppendOrInsertBefore: rawAppendChild,\n    wujieId: id,\n  }) as typeof rawAppendChild;\n  render.head.insertBefore = rewriteAppendOrInsertChild({\n    rawDOMAppendOrInsertBefore: rawHeadInsertBefore as any,\n    wujieId: id,\n  }) as typeof rawHeadInsertBefore;\n  render.head.removeChild = rewriteRemoveChild({\n    rawElementRemoveChild: rawElementRemoveChild.bind(render.head),\n    wujieId: id,\n  }) as typeof rawElementRemoveChild;\n  render.head.contains = rewriteContains({\n    rawElementContains: rawElementContains.bind(render.head),\n    wujieId: id,\n  }) as typeof rawElementContains;\n  render.contains = rewriteContains({\n    rawElementContains: rawElementContains.bind(render),\n    wujieId: id,\n  }) as typeof rawElementContains;\n  render.body.appendChild = rewriteAppendOrInsertChild({\n    rawDOMAppendOrInsertBefore: rawAppendChild,\n    wujieId: id,\n  }) as typeof rawAppendChild;\n  render.body.insertBefore = rewriteAppendOrInsertChild({\n    rawDOMAppendOrInsertBefore: rawBodyInsertBefore as any,\n    wujieId: id,\n  }) as typeof rawBodyInsertBefore;\n}\n"],"mappings":"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","ignoreList":[]}